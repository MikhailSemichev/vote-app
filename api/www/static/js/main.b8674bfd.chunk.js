(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{125:function(e,t,n){e.exports=n(249)},130:function(e,t,n){},180:function(e,t){},186:function(e,t,n){},188:function(e,t,n){},190:function(e,t,n){},192:function(e,t,n){},241:function(e,t,n){},243:function(e,t,n){},247:function(e,t,n){},249:function(e,t,n){"use strict";n.r(t);var a,i,c=n(0),o=n.n(c),r=n(17),s=n.n(r),l=(n(130),n(4)),u=n(5),p=n(8),d=n(7),m=n(9),h=n(255),f=n(257),v=n(251),g=n(112),b=n.n(g)()(),O=n(123),y=n(254),j=n(28),w=n(14),E=(n(59),n(2)),C=new(a=function(){function e(){Object(l.a)(this,e),Object(j.a)(this,"userInfo",i,this)}return Object(u.a)(e,[{key:"getUserInfo",value:function(){var e=localStorage.getItem("LOGIN"),t=localStorage.getItem("ADMIN_PASSWORD");return e?{login:e,adminPassword:t}:null}},{key:"setLogin",value:function(e,t){this.userInfo={login:e,adminPassword:t},localStorage.setItem("LOGIN",e),localStorage.setItem("ADMIN_PASSWORD",t)}},{key:"logOff",value:function(){this.userInfo=null,localStorage.removeItem("LOGIN"),localStorage.removeItem("ADMIN_PASSWORD")}},{key:"isLoggedIn",get:function(){return!!this.userInfo}}]),e}(),i=Object(w.a)(a.prototype,"userInfo",[E.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.getUserInfo()}}),Object(w.a)(a.prototype,"isLoggedIn",[E.e],Object.getOwnPropertyDescriptor(a.prototype,"isLoggedIn"),a.prototype),Object(w.a)(a.prototype,"setLogin",[E.d],Object.getOwnPropertyDescriptor(a.prototype,"setLogin"),a.prototype),Object(w.a)(a.prototype,"logOff",[E.d],Object.getOwnPropertyDescriptor(a.prototype,"logOff"),a.prototype),a),T=n(3),k=n.n(T),N=n(11);function A(e,t){var n=e.map(function(e,t){return[e,t]});return n.sort(function(e,n){var a=t(e[0],n[0]);return 0===a?e[1]-n[1]:a}),n.map(function(e){return e[0]})}function I(e){var t=new Set;return e.forEach(function(e){return t.add(e)}),Array.from(t)}var S,x=n(19),P=n.n(x),D="http://voteapp-env.3u6nmtzmda.eu-central-1.elasticbeanstalk.com".trim();!function(e){e.ON_VOTE="ON_VOTE",e.ON_TOPIC_CHANGE="ON_TOPIC_CHANGE"}(S||(S={})),P.a.defaults.baseURL="".concat(D,"/api"),P.a.interceptors.request.use(function(e){return C.userInfo&&(e.headers.ADMIN_PASSWORD=C.userInfo.adminPassword),e},function(e){return Promise.reject(e)});var V=n(22),L={getTopics:function(){return _.apply(this,arguments)},getTopic:function(e){return R.apply(this,arguments)},saveTopic:function(e){return M.apply(this,arguments)},deleteTopic:function(e){return U.apply(this,arguments)},addCandidates:function(e,t){return P.a.post("/topics/addCandidates",{topicId:e,newCandidates:t})}};function _(){return(_=Object(N.a)(k.a.mark(function e(){var t;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.a.get("/topics");case 2:return t=e.sent,e.abrupt("return",t.data.map(W));case 4:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function R(){return(R=Object(N.a)(k.a.mark(function e(t){var n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.a.get("/topics/".concat(t));case 2:if(!(n=e.sent).data){e.next=5;break}return e.abrupt("return",W(n.data));case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function W(e){return Object(V.a)({},e,{id:e._id})}function M(){return(M=Object(N.a)(k.a.mark(function e(t){return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.id){e.next=2;break}return e.abrupt("return",P.a.put("/topics",t));case 2:return e.abrupt("return",P.a.post("/topics",t));case 3:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function U(){return(U=Object(N.a)(k.a.mark(function e(t){return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",P.a.delete("/topics/".concat(t)));case 1:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var G,z,F,q,H=n(113),B=n.n(H),J={vote:function(e,t,n,a){G.emit("vote",{topicId:e,candidateName:t,login:n,isVote:a})},onTopicVotesChange:function(e,t,n){return(G=B()("".concat(D,"/votes"),{query:"topicId=".concat(e)})).on(S.ON_VOTE,function(e){t(e)}),G.on(S.ON_TOPIC_CHANGE,function(e){n(e)}),function(){return G.close()}}};var Y,$,K,Q,X,Z,ee,te,ne=new(z=function(){function e(){Object(l.a)(this,e),Object(j.a)(this,"isLoadingTopics",F,this),Object(j.a)(this,"topics",q,this)}return Object(u.a)(e,[{key:"loadTopics",value:function(){var e=Object(N.a)(k.a.mark(function e(){var t,n=this;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.isLoadingTopics=!0,this.topics=[],e.next=4,L.getTopics();case 4:t=e.sent,Object(E.m)(function(){n.topics=A(t,function(e,t){return e.id===t.id?0:e.id<t.id?-1:1}),n.isLoadingTopics=!1});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTopic",value:function(e){return L.getTopic(e)}},{key:"saveTopic",value:function(e){return L.saveTopic(e)}},{key:"deleteTopic",value:function(){var e=Object(N.a)(k.a.mark(function e(t){var n=this;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.deleteTopic(t);case 2:Object(E.m)(function(){n.topics=n.topics.filter(function(e){return e.id!==t})});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addCandidates",value:function(e,t){return L.addCandidates(e,t)}}]),e}(),F=Object(w.a)(z.prototype,"isLoadingTopics",[E.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),q=Object(w.a)(z.prototype,"topics",[E.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(w.a)(z.prototype,"loadTopics",[E.d],Object.getOwnPropertyDescriptor(z.prototype,"loadTopics"),z.prototype),z),ae=new(Y=function(){function e(){Object(l.a)(this,e),Object(j.a)(this,"topicVotes",$,this)}return Object(u.a)(e,[{key:"vote",value:function(){var e=Object(N.a)(k.a.mark(function e(t,n,a){return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",J.vote(t,n,C.userInfo.login,a));case 1:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"onTopicChange",value:function(e,t){var n=this;return this.topicVotes=[],J.onTopicVotesChange(e,function(e){Object(E.m)(function(){n.topicVotes=e})},t)}}]),e}(),$=Object(w.a)(Y.prototype,"topicVotes",[E.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(w.a)(Y.prototype,"vote",[E.d],Object.getOwnPropertyDescriptor(Y.prototype,"vote"),Y.prototype),Object(w.a)(Y.prototype,"onTopicChange",[E.d],Object.getOwnPropertyDescriptor(Y.prototype,"onTopicChange"),Y.prototype),Y),ie=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).renderRote=function(e){var t=n.props.component;return C.isLoggedIn?c.createElement(t,e):c.createElement(y.a,{to:{pathname:"/login",state:{from:e.location}}})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.component,Object(O.a)(e,["component"]));return c.createElement(v.a,Object.assign({},t,{render:this.renderRote}))}}]),t}(c.Component),ce=n(16),oe=(n(186),Object(ce.a)(K=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleLogOff=function(){C.logOff(),b.push("/login")},n.handleAppNameClick=function(){b.push("/")},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=C.userInfo;return c.createElement("div",{className:"header"},c.createElement("div",{className:"header-app-name",onClick:this.handleAppNameClick},"Vote App"),e&&c.createElement("div",{className:"header-login"},c.createElement("i",{className:"fa fa-user-circle-o"}),c.createElement("div",{className:"header-login-text"},e.login),c.createElement("i",{className:"fa fa-sign-out",title:"Log off",onClick:this.handleLogOff})))}}]),t}(c.Component))||K),re=n(256),se=n(13),le=n.n(se),ue=(n(188),Q=re.a,Object(ce.a)(X=Q(X=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showAdminPassword:!1},n.loginRef=o.a.createRef(),n.adminPasswordRef=o.a.createRef(),n.handleSubmit=function(e){e.preventDefault(),C.setLogin(n.loginRef.current.value,n.adminPasswordRef.current.value);var t=(n.props.location.state||{from:{pathname:"/"}}).from;b.push(t.pathname)},n.handleAdminPassword=function(e){e.preventDefault();var t=!n.state.showAdminPassword;n.setState({showAdminPassword:t})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=C.userInfo,t=this.state.showAdminPassword;return o.a.createElement("div",{className:"app-page login-page"},o.a.createElement("div",{className:"page-title"},o.a.createElement("h1",null,"Login Page"),o.a.createElement("p",null,"Vote App is application for voting")),o.a.createElement("form",{className:"login-form",onSubmit:this.handleSubmit},o.a.createElement("input",{type:"text",defaultValue:e&&e.login||"",placeholder:"Please type your name as in UPSA...",ref:this.loginRef}),o.a.createElement("div",{className:"btn-container"},o.a.createElement("div",{className:"admin-container"},"role:",o.a.createElement("a",{href:"#",onClick:this.handleAdminPassword},"admin"),o.a.createElement("input",{type:"password",className:le()("password-input",{hidden:!t}),autoComplete:"new-password",defaultValue:e&&e.adminPassword||"",ref:this.adminPasswordRef})),o.a.createElement("button",{className:"login-btn"},"Login"))))}}]),t}(c.Component))||X)||X),pe=n(252),de=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleDelete=function(){var e=n.props,t=e.topic;(0,e.handleDelete)(t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.topic;return c.createElement("div",{className:"topic-item"},c.createElement(pe.a,{className:"topic-item-name",to:"/vote/".concat(e.id)},e.name),c.createElement(pe.a,{to:"/topic/".concat(e.id),title:"Edit Topic"},c.createElement("i",{className:"fa fa-pencil-square-o"})),c.createElement("a",{href:"#",onClick:this.handleDelete,title:"Delete Topic"},c.createElement("i",{className:"fa fa-times"})))}}]),t}(c.Component),me=(n(190),Object(ce.a)(Z=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleNewTopic=function(){b.push("/topic")},n.handleDelete=function(e){window.confirm('Delete "'.concat(e.name,'"?'))&&ne.deleteTopic(e.id)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){ne.loadTopics()}},{key:"render",value:function(){var e=this,t=ne.topics,n=ne.isLoadingTopics,a=!n&&!t.length;return o.a.createElement("div",{className:"app-page topic-list-page"},o.a.createElement("div",{className:"page-title"},o.a.createElement("h1",null,"Topics to Vote"),o.a.createElement("button",{onClick:this.handleNewTopic},"New Topic")),o.a.createElement("div",null,n&&"Loading...",a&&"No topics. Yet :)",t&&t.map(function(t){return o.a.createElement(de,{key:t.id,topic:t,handleDelete:e.handleDelete})})))}}]),t}(c.Component))||Z),he=n(37),fe=n(253),ve=(n(192),(0,re.a)(ee=Object(ce.a)(ee=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={topic:null,isSaving:!1},n.handleSubmit=function(){var e=Object(N.a)(k.a.mark(function e(t){var a,i,c,o,r,s,l;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n.state.isSaving||!n.state.topic){e.next=15;break}return a=n.state.topic,i=a._id,c=a.id,o=a.name,r=a.candidatesText,s=a.isActive,l=a.isAllowAddCandidates,console.log(o),n.setState({isSaving:!0}),e.prev=5,e.next=8,ne.saveTopic({id:c,_id:i,name:o,candidates:I(r.split("\n")).filter(function(e){return e}).map(function(e){return{name:e}}),isActive:s,isAllowAddCandidates:l});case 8:n.props.history.push("/"),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(5),alert(e.t0.response.data),n.setState({isSaving:!1});case 15:case"end":return e.stop()}},e,this,[[5,11]])}));return function(t){return e.apply(this,arguments)}}(),n.handleTextChange=function(e){var t=e.target,a=t.name,i=t.value;n.handleValueChange(a,i)},n.handleStatusChange=function(e){n.handleValueChange("isActive",e)},n.handleAllowAddCandidatesChange=function(e){n.handleValueChange("isAllowAddCandidates",e)},n.handleValueChange=function(e,t){var a=Object(V.a)({},n.state.topic,Object(he.a)({},e,t));n.setState({topic:a})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.loadTopic()}},{key:"componentDidUpdate",value:function(e){this.getTopicId()!==e.match.params.topicId&&this.loadTopic()}},{key:"getTopicId",value:function(){return this.props.match.params.topicId}},{key:"loadTopic",value:function(){var e=Object(N.a)(k.a.mark(function e(){var t,n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.getTopicId())){e.next=7;break}return e.next=4,ne.getTopic(t);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0={name:"",isActive:!0,isAllowAddCandidates:!0,candidates:[],candidatesText:""};case 8:(n=e.t0).candidatesText=n.candidates.map(function(e){return e.name}).join("\n"),this.setState({topic:Object(V.a)({},n),isSaving:!1});case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.getTopicId(),t=this.state,n=t.topic,a=t.isSaving;return o.a.createElement("div",{className:"app-page edit-topic-page"},o.a.createElement("form",{onSubmit:this.handleSubmit},o.a.createElement("div",{className:"page-header"},o.a.createElement("h1",null,e?"Edit":"Create"," Topic Page"),o.a.createElement("button",{className:"save-btn",disabled:a},a?"Saving...":"Save")),n&&o.a.createElement("div",null,o.a.createElement("div",{className:"field"},o.a.createElement("div",{className:"field-label"},o.a.createElement("label",{htmlFor:"topicName"},"Topic Name")),o.a.createElement("input",{id:"topicName",name:"name",value:n.name,onChange:this.handleTextChange,type:"text"})),o.a.createElement("div",{className:"field"},o.a.createElement("div",{className:"field-label"},o.a.createElement("label",{htmlFor:"topicCandidates"},"Topic Candidates")),o.a.createElement("textarea",{id:"topicCandidates",name:"candidatesText",onChange:this.handleTextChange,rows:10,value:n.candidatesText})),o.a.createElement("div",{className:"field"},o.a.createElement("label",null,"Topic Status:"),o.a.createElement(fe.a,{checked:n.isActive,onChange:this.handleStatusChange,checkedChildren:"In progress",unCheckedChildren:"Closed"})),o.a.createElement("div",{className:"field"},o.a.createElement("label",null,"Allow Add Candidates:"),o.a.createElement(fe.a,{checked:n.isAllowAddCandidates,onChange:this.handleAllowAddCandidatesChange,checkedChildren:"Yes",unCheckedChildren:"No"})),o.a.createElement("div",{className:"btn-container"},o.a.createElement("button",{className:"save-btn",disabled:a},a?"Saving...":"Save")))),!n&&o.a.createElement("div",null,"Loading..."))}}]),t}(c.Component))||ee)||ee),ge=(n(241),n(243),function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={isAdding:!1,candidatesText:""},n.handleAddingCandidate=function(){n.setState({isAdding:!0})},n.handleAddCandidate=function(e){e.preventDefault();var t=n.props.topic,a=I(n.state.candidatesText.split("\n").map(function(e){return e.trim()}).filter(function(e){return e}));n.clearForm(),ne.addCandidates(t.id,a)},n.handleTextChange=function(e){n.setState({candidatesText:e.target.value})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"clearForm",value:function(){this.setState({isAdding:!1,candidatesText:""})}},{key:"render",value:function(){var e=this.state,t=e.isAdding,n=e.candidatesText,a=this.props.topic;return a?o.a.createElement("div",{className:"new-candidate"},a&&o.a.createElement("div",null,!t&&o.a.createElement("button",{onClick:this.handleAddingCandidate},"Add New Option"),t&&o.a.createElement("div",null,o.a.createElement("form",{onSubmit:this.handleAddCandidate},o.a.createElement("textarea",{value:n,onChange:this.handleTextChange}),o.a.createElement("button",{className:"save-btn",disabled:!n},"Save"))))):null}}]),t}(c.Component)),be=(0,re.a)(te=Object(ce.a)(te=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={topic:null},n.closeSocket=void 0,n.handleVote=function(e,t){ae.vote(n.getTopicId(),e,t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.loadTopic()}},{key:"componentDidUpdate",value:function(e){this.getTopicId()!==e.match.params.topicId&&this.loadTopic()}},{key:"componentWillUnmount",value:function(){this.closeSocket&&this.closeSocket()}},{key:"getTopicId",value:function(){return this.props.match.params.topicId}},{key:"loadTopic",value:function(){var e=Object(N.a)(k.a.mark(function e(){var t,n,a=this;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getTopicId(),this.closeSocket&&this.closeSocket(),this.closeSocket=ae.onTopicChange(t,function(){a.loadTopic()}),e.next=5,ne.getTopic(t);case 5:n=e.sent,this.setState({topicId:t,topic:n&&Object(V.a)({},n)});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.topic,n=ae.topicVotes,a=C.userInfo,i=[];if(t&&n){i=A(i=t.candidates.map(function(e){var t=n.filter(function(t){return e.name===t.candidateName}).map(function(e){return e.login});return{name:e.name,isVoted:t.includes(a.login),logins:t,place:0}}),function(e,t){return t.logins.length-e.logins.length});var c,r=1;i=i.map(function(e){return r<=3&&e.logins.length?(c&&c!==e.logins.length&&r++,c=e.logins.length,Object(V.a)({},e,{place:r})):e})}return o.a.createElement("div",{className:"app-page vote-page"},t&&o.a.createElement("div",null,o.a.createElement("h1",null,t.name),o.a.createElement("div",null,i.map(function(n){return o.a.createElement("div",{className:le()("candidate-item",{"is-voted":n.isVoted}),key:n.name},o.a.createElement("div",{className:"votes-count"},o.a.createElement("div",{className:le()("count",Object(he.a)({},"place-".concat(n.place),n.place)),title:n.logins.join(" | ")},n.logins.length)),o.a.createElement("div",{className:"candidate-name"},n.name),t.isActive&&o.a.createElement("i",{className:le()("fa","vote-btn",{"fa-thumbs-o-up":!n.isVoted,"fa-thumbs-up":n.isVoted}),onClick:function(){return e.handleVote(n.name,!n.isVoted)}}))})),t.isAllowAddCandidates&&o.a.createElement(ge,{topic:t})),!t&&o.a.createElement("div",null,"Loading..."))}}]),t}(c.Component))||te)||te,Oe=(n(245),n(247),function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return c.createElement(h.a,{history:b},c.createElement("div",{className:"app"},c.createElement(oe,null),c.createElement(f.a,null,c.createElement(f.a,null,c.createElement(v.a,{path:"/login",component:ue}),c.createElement(ie,{exact:!0,path:"/",component:me}),c.createElement(ie,{path:"/topic/:topicId?",component:ve}),c.createElement(ie,{path:"/vote/:topicId",component:be})))))}}]),t}(c.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(Oe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[125,2,1]]]);
//# sourceMappingURL=main.b8674bfd.chunk.js.map